name: ğŸš§ Publish Website
on:
  workflow_dispatch:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“‚ Deploying Website
        uses: appleboy/ssh-action@v0.1.4
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          key: ${{ secrets.SSH_KEY }}
          port: ${{ secrets.SSH_PORT }}
          script: |
            echo ğŸ“‚ Changing to the desired directory...
            pushd "/home/${{ secrets.SSH_USERNAME }}/${{ secrets.SSH_HOST }}"
            
            echo ğŸ—ƒï¸ Pulling git files...
            git fetch --all
            git reset --hard origin/main
            
            echo ğŸ—‚ï¸ Installing new dependencies...
            source venv/bin/activate
            which python3 pip
            pip install -r requirements.txt
            deactivate
            popd
            
            echo ğŸ”¨ Building Website
            echo "noop"
            
            echo ğŸ”„ Restarting website...
            touch "/home/${{ secrets.SSH_USERNAME }}/${{ secrets.SSH_HOST }}/tmp/restart.txt"
            echo âœ”ï¸ Website Updated